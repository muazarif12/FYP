import spacy
from nltk.tokenize import sent_tokenize

# Load English NLP model
nlp = spacy.load("en_core_web_sm")

def dependency_segmentation(text):
    """Segments text based on logical dependency chunks using spaCy."""
    sentences = sent_tokenize(text)  # Sentence tokenization
    chunks = []
    current_chunk = []

    for sent in sentences:
        doc = nlp(sent)
        for token in doc:
            if token.dep_ in ("ROOT", "cc", "mark"):  # Major structural words
                if current_chunk:
                    chunks.append(" ".join(current_chunk))
                    current_chunk = []
            current_chunk.append(token.text)

        if current_chunk:
            chunks.append(" ".join(current_chunk))
            current_chunk = []

    return chunks

# Example Usage
text=""" When Allah wants you to get something, to achieve something or to give you something, nobody can stop it. Even if the whole world is trying to block you from achieving something, they won't be able to do it. وَعْلَمْ أَنَّ الْأُمَّةَ لَوِ اجْتَمَعَتْ عَلَىٰ أَنْ يَنفَعُوكَ بِشَيْءٍ لَمْ يَنفَعُوكَ إِلَّا بِمَا قَدْ كَتَبَهُ اللَّهُ لَكَ Oh, لن ينفعوكَ إِلَّا بِمَا قَدْ كَتَبَهُ اللَّهُ لَكَ If the whole nation gets together to benefit you, they won't be able to benefit you except with that which Allah has written for you. And the opposite also is in the same hadith. The Prophet Muhammad ﷺ is telling us that if the entire ummah, the whole nation gets together to harm you, they will never be able to inflict any harm upon you unless Allah has written it against you. If Allah has written it against you, you need to know nothing is going to stop it. May Allah protect us all. Look at this man, young baby, born, Fir'aun looking, searching, his men were everywhere. They were spies all over. They didn't hear, they didn't witness, they didn't see. And Allah subhanahu wa ta'ala inspired his mother to do something unique, to put him into a little casket or a basket, and to put him or literally to cast him into the Nile, into the river, cast him into the river. How can I do that? Don't worry. The one who made him will look after him. Subhanallah. The one who made him will look after him. Allah says, Al-Qi-hi fi al-yam wa la ta-khafi wa la tahzani Inna raddu ilayki wa ja'ilu min al-mursaleen Instruction from Allah subhanahu wa ta'ala. Inspiration from Allah subhanahu wa ta'ala. Take him and place him in the water, in the river. Allah will return him to you. Allah says, we will return him to you. Subhanallah. And we will make him from amongst those who is sent. We will make him a messenger. He's going to have something big. Subhanallah. And what happened? Allah did not bless the Pharaoh with children. They were looking for this male child. And the wife, as she was walking, she notices this little casket, and she picks up this baby. And the baby was absolutely gorgeous. Absolutely innocent. Totally. And cut a long story short. They looked after Musa alayhi salatu was salam until he grew quite old. He was not suckling from anyone because that was the plan of Allah. And they were desperate to get him to suckle because he needed to survive. Until subhanallah. Subhanallah. Amazingly, Allah returned the baby as a baby, as an infant to the mother. He would be brought in the highest form of luxury. He would be brought to the mother. The mother would suckle, spend some time, etc, etc. Look after him, breastfeed him, whatever else, and send him back. And he suckled from no one else. This is the power of Allah. Never underestimate the power of Allah. Subhanahu wa ta'ala. When he wants to give you, he will give you. Pray to him. Pray hard. Pray with conviction. When the time is right, what you want will come to you. Remember that. If it is good for you, and if it is meant for you, it's in coming in your direction. If it is not, no matter what, it won't. So Allah subhanahu wa ta'ala says, We returned him to his mother in order for her eyes to be cooled and for her not to be saddened. She was a good woman. She was close to Allah subhanahu wa ta'ala. She was chosen to be the mother of a messenger of Allah subhanahu wa ta'ala. Imagine what qualities she had. I always tell the sisters and even the brothers that if you want a child who's going to be someone serving the deen, ask yourself, who am I to start with? Who am I to start with? If I'm a person who wants to follow the trends of today and I have my little heels and my makeup and my mini skirt and I'm walking around with a little handbag, throwing things behind my back like this. Do you want a child who's going to really be some form of, you know, service to the deen? The same applies to the brothers. Every night you're in the club, you know, jumping and dancing and drinking and everything else and womanizing and all of those nature of things, you know, that type of thing. And then you say, Oh Allah, make my child a big, you know, sheikh who's going to be spreading the deen. Subhanallah, subhanallah, your sheikh is in the night club. That's what it is. And you want your child to be the sheikh spreading the deen. You know, Allah can do it. But you need to repent. You need to turn back. It's never too late. My brothers and sisters, we turn to Allah. We turn to Allah subhanahu wa ta'ala. It's not too late. We're breathing. Take a look at the world. Learn by looking at the globe. Watch the people. See the most content people are not those who run behind materialistic items. Remember that. Wallahi, I promise you. Yes, you might look at glamour. You might look at popularity. You might look at someone who the world looks at as wow, a superhero. Someone who's a movie star in real life. They are depressed. They are struggling. They have addiction sometimes to various things, even drugs. They suffer with problems. They are bipolar. Look at so many of these pop stars popping one after the other. Pop, pop, pop, pop. Have you seen that? That's why they're called pop stars. May Allah subhanahu wa ta'ala help us. My brothers and sisters, we need to serve the ummah. We need to have a concern for the next generations. We need to serve Allah so that at least in our progeny when they watch us, do you know the most powerful way of relaying the message is for them to follow by example. When you are fulfilling salah, when you dress in a specific way, your child who cannot yet speak in your language, who cannot yet communicate properly in your own system will fight to dress the way you dress just because that is the plan of Allah subhanahu wa ta'ala. If you fulfill your salah constantly, your child will be found in sujood before they can even walk. Do you know that? Why? Did you talk to them? No. It was Allah's way of telling you, look, if you are good, inshallah, by the will of Allah, they will have a good upbringing. What they do beyond a certain age becomes between them and Allah. Once you arrive at a certain point, it's now your life. I looked after my children up to a certain age. An example, just an example. I'm not talking about myself, but I'm saying if I look after my children for a certain age up to a certain age, beyond that, if they end up dwindling left and right, I can always say, Ya Allah, I offered them the best. I still make dua for them. I will still guide them. But now they're independent. They are doing things. It's up to them now. It's between you and them. Ya Allah, guide them. Subhanallah. I can try when I say I can guide them and Allah guides them two different types of guidance. One is الدلال والإرشاد. One is to show them the way. I can show them the way to say, look, this is the way. But التوفيق is from Allah. The guidance in the sense that to bring them onto the path is from Allah. May Allah bring our children on the path and before that, may Allah bring us on the path and keep us steadfast. Remember, when you follow your faith, considering it and honor to follow your faith, that is when you have achieved something. But when you follow your faith, considering it a burden, yes, you may be following, but you will not achieve the true benefit of the entire package. People fulfill salah. When you fulfill salah, you're lazy to do it. You're just doing it because, hey, you know what? I'm scared. I don't want to be punished. Okay, fair enough. Your salah may be done. But if you want to achieve the broader benefits of that beautiful salah, do it as an honor. Oh Allah, I love you. I'm going to fulfill this salah because I want to do it for your sake. You've given me so much, Ya Allah. Amazing. My brothers and sisters, getting back to the Pharaoh, Musa alayhi salatu was salam brought up in this home, going back to his mother. I want to draw another lesson for us all. Sometimes we are separated from our loved ones. Agree? Whether it's your child after a divorce, whether it is someone prior to divorce, maybe your husband had to go and work somewhere, maybe you had to go somewhere, maybe something happened, you were separated for some reason. Sometimes the separation is caused by a third party intentionally. The story of Musa alayhi salatu was salam, the lessons, the ayat, the lessons we learn, it consoles those who are separated from their loved ones saying, inna raddu ilaik, we will definitely return him to you. If Musa alayhi salam's mother was told that by Allah, I'm sure Allah can return to us our loved ones. May Allah subhanahu wa ta'ala unite us with our loved ones. Sometimes we are separated through death. Do you know that? Death has separated me from my loved one, for example, or a child or a parent or a brother, sibling, someone you really care for, you really love, don't worry. Allah speaks about how He will allow your family members to join you in the hereafter on condition that you all believed. On condition that you all believed. You need to try to earn the pleasure of Allah. You did it. Your children did it. You tried your best. Allah says, we will gather you together. Don't worry. You're going to be united. When you lose a loved one through death, it's not the end of the path. By the will of Allah, you will meet them again very soon. A matter of time. May Allah subhanahu wa ta'ala grant that to us and may we meet them in a better place, not in a worse place. May Allah subhanahu wa ta'ala forgive us."""
chunks = dependency_segmentation(text)

output_file = 'output_dependency_segmentation.txt'
print(f"Total chunks: {len(chunks)}")

# Open the file in write mode ('w') with UTF-8 encoding
with open(output_file, 'w', encoding='utf-8') as file:
    for i, chunk in enumerate(chunks, 1):
        file.write(f"Chunk {i}: {chunk}\n\n")

print(f"Output has been written to {output_file}")
